<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Veo 3 Flow Automator</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <header>
    <h1>Veo 3 Flow Automator</h1>
    <div id="statusBar" class="status idle">Idle</div>
  </header>

  <section id="tabNav">
    <button class="tab-btn active" data-tab="prompts">Prompts</button>
    <button class="tab-btn" data-tab="settings">Settings</button>
    <button class="tab-btn" data-tab="picker">Picker</button>
    <button class="tab-btn" data-tab="logs">Logs</button>
  </section>

  <!-- Prompts Tab -->
  <section id="tab-prompts" class="tab-content active">
    <div class="input-group">
      <textarea id="promptInput" rows="3" placeholder="Enter a prompt..."></textarea>
      <button id="addPromptBtn" class="btn btn-sm">Add Prompt</button>
    </div>
    <div class="input-group">
      <label class="file-label">
        <input type="file" id="fileUpload" accept=".txt,.csv" hidden>
        <span class="btn btn-sm btn-secondary">Upload .txt / .csv</span>
      </label>
      <button id="clearQueueBtn" class="btn btn-sm btn-danger">Clear Queue</button>
    </div>
    <div id="queueList" class="queue-list">
      <p class="empty-msg">No prompts in queue</p>
    </div>
  </section>

  <!-- Settings Tab -->
  <section id="tab-settings" class="tab-content">
    <div class="settings-section-header">Pipeline</div>
    <div class="setting-row">
      <label for="delayBetween">Delay between generations (sec)</label>
      <input type="number" id="delayBetween" min="0" max="120" value="5">
    </div>
    <div class="setting-row">
      <label for="autoDownload">Auto-download videos</label>
      <input type="checkbox" id="autoDownload" checked>
    </div>
    <div class="setting-row">
      <label for="maxRetries">Max retries on failure</label>
      <input type="number" id="maxRetries" min="0" max="10" value="2">
    </div>
    <div class="setting-row">
      <label for="completionTimeout">Completion timeout (sec)</label>
      <input type="number" id="completionTimeout" min="30" max="600" value="300">
    </div>

    <div class="settings-section-header">Video Specifications</div>
    <div class="setting-row">
      <label for="specAspectRatio">Aspect Ratio</label>
      <select id="specAspectRatio">
        <option value="">Default</option>
        <option value="16:9">16:9</option>
        <option value="9:16">9:16</option>
        <option value="1:1">1:1</option>
      </select>
    </div>
    <div class="setting-row">
      <label for="specDuration">Duration</label>
      <select id="specDuration">
        <option value="">Default</option>
        <option value="5s">5s</option>
        <option value="10s">10s</option>
      </select>
    </div>
    <div class="setting-row">
      <label for="specStyle">Style</label>
      <select id="specStyle">
        <option value="">Default</option>
        <option value="Cinematic">Cinematic</option>
        <option value="Animated">Animated</option>
      </select>
    </div>

    <div class="settings-section-header">Download</div>
    <div class="setting-row">
      <label for="downloadFolder">Subfolder name</label>
      <input type="text" id="downloadFolder" placeholder="e.g. veo3_videos">
    </div>
    <p class="hint">Files save to: Downloads/[subfolder]/</p>

    <button id="saveSettingsBtn" class="btn">Save Settings</button>
  </section>

  <!-- Picker Tab -->
  <section id="tab-picker" class="tab-content">
    <p class="hint">Click "Pick" then click the matching element on the Flow page. The popup will close â€” reopen to see results.</p>

    <div class="picker-role" data-role="promptInput">
      <div class="picker-role-header">
        <span class="picker-role-name">Prompt Input</span>
        <button class="btn btn-sm pick-btn" data-role="promptInput">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="promptInput">Not set</div>
    </div>

    <div class="picker-role" data-role="generateButton">
      <div class="picker-role-header">
        <span class="picker-role-name">Generate Button</span>
        <button class="btn btn-sm pick-btn" data-role="generateButton">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="generateButton">Not set</div>
    </div>

    <div class="picker-role" data-role="downloadButton">
      <div class="picker-role-header">
        <span class="picker-role-name">Download Button</span>
        <button class="btn btn-sm pick-btn" data-role="downloadButton">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="downloadButton">Not set</div>
    </div>

    <div class="picker-role" data-role="videoElement">
      <div class="picker-role-header">
        <span class="picker-role-name">Video Element</span>
        <button class="btn btn-sm pick-btn" data-role="videoElement">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="videoElement">Not set</div>
    </div>

    <div class="picker-role" data-role="loadingIndicator">
      <div class="picker-role-header">
        <span class="picker-role-name">Loading Indicator</span>
        <button class="btn btn-sm pick-btn" data-role="loadingIndicator">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="loadingIndicator">Not set</div>
    </div>

    <div class="picker-role" data-role="errorIndicator">
      <div class="picker-role-header">
        <span class="picker-role-name">Error Indicator</span>
        <button class="btn btn-sm pick-btn" data-role="errorIndicator">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="errorIndicator">Not set</div>
    </div>

    <div class="settings-section-header">Spec Controls (Advanced)</div>
    <p class="hint">Pick the Flow page controls for video specs so the extension can set them automatically.</p>

    <div class="picker-role" data-role="spec_aspectRatio">
      <div class="picker-role-header">
        <span class="picker-role-name">Aspect Ratio Control</span>
        <button class="btn btn-sm pick-btn" data-role="spec_aspectRatio">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="spec_aspectRatio">Not set</div>
    </div>

    <div class="picker-role" data-role="spec_duration">
      <div class="picker-role-header">
        <span class="picker-role-name">Duration Control</span>
        <button class="btn btn-sm pick-btn" data-role="spec_duration">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="spec_duration">Not set</div>
    </div>

    <div class="picker-role" data-role="spec_style">
      <div class="picker-role-header">
        <span class="picker-role-name">Style Control</span>
        <button class="btn btn-sm pick-btn" data-role="spec_style">Pick</button>
      </div>
      <div class="picker-status not-set" data-role-status="spec_style">Not set</div>
    </div>

    <div class="btn-row">
      <button id="testAllBtn" class="btn btn-secondary">Test All</button>
      <button id="clearAllPicksBtn" class="btn btn-danger">Clear All</button>
    </div>
  </section>

  <!-- Logs Tab -->
  <section id="tab-logs" class="tab-content">
    <div id="logList" class="log-list">
      <p class="empty-msg">No logs yet</p>
    </div>
    <button id="clearLogsBtn" class="btn btn-sm btn-danger">Clear Logs</button>
  </section>

  <!-- Controls -->
  <footer>
    <button id="startBtn" class="btn btn-primary">Start</button>
    <button id="pauseBtn" class="btn btn-secondary" disabled>Pause</button>
    <button id="stopBtn" class="btn btn-danger" disabled>Stop</button>
  </footer>

  <script src="../utils/storage.js"></script>
  <script src="popup.js"></script>
</body>
</html>
